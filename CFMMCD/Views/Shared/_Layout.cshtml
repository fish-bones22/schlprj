@using CFMMCD.Sessions
@using CFMMCD.Models.ViewModel
@{
    UserAccessSession UASession = new UserAccessSession();
    if (Session["UserAccess"] != null)
    {
        UASession = (UserAccessSession)Session["UserAccess"];
    }
    CurrentPageSession CPSession = (CurrentPageSession)Session["CurrentPage"];
    if (CPSession == null)
    {
        CPSession = new CurrentPageSession();
        CPSession.Self = new CurrentPageSession.LinkString
        {
            LinkName = "Login",
            Action = "Login",
            Controller = "Account"
        };
    }

} 
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@CPSession.Self.LinkName</title>
    <script src="~/Scripts/modernizr-2.8.3.js"></script>
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/fonts.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/Site.css" rel="stylesheet" type="text/css" />
    <link href="~/Content/bootstrap-submenu.min.css" rel="stylesheet" type="text/css" />

    <script src="~/Scripts/jquery-3.1.1.min.js"></script>
    <script src="~/Scripts/jquery-3.1.1.min.js"></script>
    <script src="~/Scripts/bootstrap-submenu.min.js"></script>
    <script src="~/Scripts/philippines/index.js"></script>
</head>
<body>
    <div class="navbar navbar-fixed-top">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar glyphicon-menu-hamburger glyphicon"></span>
            </button>
            <a class="navbar-brand" href="/Home/Index"><img class="brand-img img-responsive" src="~/Content/Images/logo.png"></a>
        </div>
        <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                @{
                    if (CPSession.Grandparent != null)
                    {
                        <li>@Html.ActionLink(CPSession.Grandparent.LinkName, CPSession.Grandparent.Action, CPSession.Grandparent.Controller, new { }, new { @class = "navbar-a" })</li>
                    }
                    if (CPSession.Parent != null)
                    {
                        if (CPSession.Parent.Controller.Equals("Home") || CPSession.Self.Controller.Equals("Home")) {
                            <li class="navbar-li"><a class="dropdown-toggle navbar-a dropdown-item" type="button" data-toggle="dropdown" data-submenu aria-expanded="false" href="#">All Pages <span class="caret"></span></a>
                                <ul class="dropdown-menu">
                                    @{ if (UASession.MIM)
                                        {
                                            <li>@Html.ActionLink("Menu Item Master", "Index", "MenuItemMaster", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr"/>
                                        }
                                        if (UASession.RIM)
                                        {
                                            <li>@Html.ActionLink("Raw Item Master", "Index", "RawItemMaster", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.MER)
                                        {
                                            <li>@Html.ActionLink("Menu Recipe", "Index", "MenuRecipe", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.STP)
                                        {
                                            <li>@Html.ActionLink("Store Profile", "Index", "StoreProfile", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.VEM)
                                        {
                                            <li>@Html.ActionLink("Vendor Master", "Index", "VendorMaster", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.SCM)
                                        {
                                            <li>@Html.ActionLink("SCM Master Recipe", "Index", "SCMRecipe", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.VAM)
                                        {
                                            <li>@Html.ActionLink("Value Meal", "Index", "ValueMeal", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.UAP)
                                        {
                                            <li class="dropdown-submenu">
                                                <a class="dropdown-item" role="menu" data-toggle="dropdown" tabindex="-1" href="#">User access&emsp;</a>
                                                <ul class="dropdown-menu">
                                                    <li>@Html.ActionLink("Create user account", "CreateAccount", "Account", new { }, new { @class = "dropdown-item" })</li>
                                                    <hr class="dropdown-hr" />
                                                    <li>@Html.ActionLink("Manage user account", "EditAccount", "Account", new { }, new { @class = "dropdown-item" })</li>
                                                    <hr class="dropdown-hr" />
                                                    <li>@Html.ActionLink("Manage user access", "EditAccess", "Account", new { }, new { @class = "dropdown-item" })</li>
                                                </ul>
                                            </li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.MIP)
                                        {
                                            <li>@Html.ActionLink("Menu Item Price Update", "Index", "MenuItemPriceUpdate", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.RIM)
                                        {
                                            <li>@Html.ActionLink("Raw Item Price Update", "Index", "RawItemPriceUpdate", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.TEG)
                                        {
                                            <li>@Html.ActionLink("Text Generation", "Index", "TextGenerator", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.REG)
                                        {
                                            <li>@Html.ActionLink("Report generation", "Index", "ReportGeneration", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }
                                        if (UASession.AUL)
                                        {
                                            <li>@Html.ActionLink("Audit log", "Index", "AuditLog", new { }, new { @class = "dropdown-item" })</li>
                                            <hr class="dropdown-hr" />
                                        }

                                        <li class="dropdown-submenu">
                                            <a class="dropdown-item" role="menu" data-toggle="dropdown" tabindex="-0" href="#">Table Maintenance</a>
                                            <ul class="dropdown-menu">
                                                @{  
                                                    if (UASession.TIP)
                                                    {

                                                        <li class="dropdown-submenu">
                                                            <a role="menu" data-toggle="dropdown" tabindex="-1" href="#" style="color:white">Tier Page</a>
                                                            <ul class="dropdown-menu">
                                                                <li>@Html.ActionLink("Dessert Enterprise Tier", "Index", "DessertPriceTier", new { }, new { @class = "dropdown-item" })</li>
                                                                <hr class="dropdown-hr" />
                                                                <li>@Html.ActionLink("Breakfast Price Tier", "Index", "BreakfastPriceTier", new { }, new { @class = "dropdown-item" })</li>
                                                                <hr class="dropdown-hr" />
                                                                <li>@Html.ActionLink("Regular Price Tier", "Index", "RegularPriceTier", new { }, new { @class = "dropdown-item" })</li>
                                                                <hr class="dropdown-hr" />
                                                                <li>@Html.ActionLink("McCafe level 2 Price Tier", "Index", "McCafeLevel2PriceTier", new { }, new { @class = "dropdown-item" })</li>
                                                                <hr class="dropdown-hr" />
                                                                <li>@Html.ActionLink("McCafe level 3 Price Tier", "Index", "McCafeLevel3PriceTier", new { }, new { @class = "dropdown-item" })</li>
                                                                <hr class="dropdown-hr" />
                                                                <li>@Html.ActionLink("McCafe BISTRO Price Tier", "Index", "McCafeBistroPriceTier", new { }, new { @class = "dropdown-item" })</li>
                                                                <hr class="dropdown-hr" />
                                                                <li>@Html.ActionLink("MDS Price Tier", "Index", "MDSPriceTier", new { }, new { @class = "dropdown-item" })</li>
                                                                <hr class="dropdown-hr" />
                                                                <li>@Html.ActionLink("Project Gold Price Tier", "Index", "ProjectGoldPriceTier", new { }, new { @class = "dropdown-item" })</li>
                                                            </ul>
                                                        </li>
                                                        <hr class="dropdown-hr" />
                                                    }
                                                    if (UASession.OWN)
                                                    {
                                                        <li>@Html.ActionLink("Ownership", "Index", "Ownership", new { }, new { @class = "dropdown-item" })</li>
                                                        <hr class="dropdown-hr" />
                                                    }
                                                    if (UASession.BUE)
                                                    {
                                                        <li>@Html.ActionLink("Business Extension", "Index", "BusinessExtension", new { }, new { @class = "dropdown-item" })</li>
                                                        <hr class="dropdown-hr" />
                                                    }
                                                    if (UASession.LOC)
                                                    {
                                                        <li>@Html.ActionLink("Location", "Index", "Location", new { }, new { @class = "dropdown-item" })</li>
                                                        <hr class="dropdown-hr" />
                                                    }
                                                    if (UASession.PRC)
                                                    {
                                                        <li>@Html.ActionLink("Profit center", "Index", "ProfitCenter", new { }, new { @class = "dropdown-item" })</li>
                                                    }
                                                }
                                            </ul>
                                            <hr class="dropdown-hr" />
                                        </li>
                                                    if (UASession.GRP)
                                                    {
                                            <li class="dropdown-submenu">
                                                <a class="dropdown-item" role="menu" data-toggle="dropdown" tabindex="-1" href="#">Group maintenance&emsp;</a>
                                                <ul class="dropdown-menu">
                                                    <li>@Html.ActionLink("Menu Item Group", "Index", "MenuItemGroup", new { }, new { @class = "dropdown-item" })</li>
                                                    <hr class="dropdown-hr" />
                                                    <li>@Html.ActionLink("Raw Item Group", "Index", "RawItemGroup", new { }, new { @class = "dropdown-item" })</li>
                                                    <hr class="dropdown-hr" />
                                                    <li>@Html.ActionLink("Recipe Group", "Index", "RecipeGroup", new { }, new { @class = "dropdown-item" })</li>
                                                </ul>
                                            </li>
                                                    }
                                    }
                                </ul>
                            </li>             
                                                    }
                                                    else
                                                    {
                            <li class="navbar-li">@Html.ActionLink(CPSession.Parent.LinkName, CPSession.Parent.Action, CPSession.Parent.Controller, new { }, new { @class = "navbar-a" })</li>
                                                        }
                                                    }
                                                    if (CPSession.Self != null)
                                                    {
                        <li class="navbar-li">@Html.ActionLink(CPSession.Self.LinkName, CPSession.Self.Action, CPSession.Self.Controller, new { }, new { @class = "navbar-a" })</li>
                                                    }
                }
            </ul>
            @{ 
                List<NotificationViewModel> notif = new List<NotificationViewModel>();
                string header = "New items";
                if (CPSession.Self.Controller.Equals("MenuItemMaster"))
                {
                    if (Session["MenuItemNotif"] != null)
                    {
                        notif = ((List<NotificationViewModel>)Session["MenuItemNotif"]);
                        header = "New Menu item";
                        if (notif.Count() > 1)
                        {
                            header = "New Menu items";
                        }

                    }
                }
                else if (CPSession.Self.Controller.Equals("RawItemMaster"))
                {
                    if (Session["RawItemNotif"] != null)
                    {
                        notif = ((List<NotificationViewModel>)Session["RawItemNotif"]);
                        header = "New Raw item";
                        if (notif.Count() > 1)
                        {
                            header = "New Raw items";
                        }
                    }
                }
                else if (CPSession.Self.Controller.Equals("VendorMaster"))
                {
                    if (Session["VendorNotif"] != null)
                    {
                        notif = ((List<NotificationViewModel>)Session["VendorNotif"]);
                        header = "New Vendor";
                        if (notif.Count() > 1)
                        {
                            header = "New Vendors";
                        }
                    }
                }
                else if (CPSession.Self.Controller.Equals("TextGenerator") || CPSession.Self.Controller.Equals("ReportGeneration"))
                {
                    if (Session["MenuItemNotif"] != null)
                    {
                        notif.AddRange((List<NotificationViewModel>)Session["MenuItemNotif"]);
                    }
                    if (Session["RawItemNotif"] != null)
                    {
                        notif.AddRange((List<NotificationViewModel>)Session["RawItemNotif"]);
                    }
                    if (Session["VendorNotif"] != null)
                    {
                        notif.AddRange((List<NotificationViewModel>)Session["VendorNotif"]);
                    }
                    header = "New Item";
                    if (notif.Count() > 1)
                    {
                        header = "New Items";
                    }
                }
                else if (CPSession.Self.Controller.Equals("MenuRecipe"))
                {
                    if (Session["MenuItemNotif"] != null)
                    {
                        notif.AddRange((List<NotificationViewModel>)Session["MenuItemNotif"]);
                    }
                    if (Session["RawItemNotif"] != null)
                    {
                        notif.AddRange((List<NotificationViewModel>)Session["RawItemNotif"]);
                    }
                    header = "New Item";
                    if (notif.Count() > 1)
                    {
                        header = "New Items";
                    }
                }
            }
            @{if (  CPSession.Self.Controller.Equals("MenuItemMaster") || 
                    CPSession.Self.Controller.Equals("RawItemMaster") || 
                    CPSession.Self.Controller.Equals("VendorMaster") || 
                    CPSession.Self.Controller.Equals("TextGenerator") ||
                    CPSession.Self.Controller.Equals("ReportGeneration") ||
                    CPSession.Self.Controller.Equals("MenuRecipe"))
                {
                    
                    <ul class="nav navbar-nav navbar-right " style="padding-right:20px">
                        <li class="navbar-li" ><a class="navbar-a dropdown-toggle navbar-a dropdown-item" data-toggle="dropdown" data-submenu aria-expanded="false" href="#">Notifications@{ if (notif.Count() > 0) { <span class="badge">@notif.Count()</span> } }</a>
                            <ul id="dropdown-menu" class="dropdown-menu col-lg-5 notification-popover">
                                <li class="">
                                    <div class="content">
                                        <table class="table-condensed">
                                            @{
                                                if (notif.Count() > 0)
                                                {
                                                    <thead><tr><th colspan="4">@header</th></tr></thead>
                                                    <tbody>
                                                        @foreach (var v in notif)
                                                        {
                                                            <tr>
                                                                <td>@v.ItemCode</td>
                                                                <td>@v.ItemName</td>
                                                                <td>@v.Action</td>
                                                                <td>@v.Page</td>
                                                            </tr>
                                                        }
                                                    </tbody>
                                                }
                                                else
                                                {
                                                    <tbody>
                                                        <tr><td colspan="4">No notifications</td></tr>
                                                    </tbody>
                                                }
                                            }
                                        </table>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                }
            }

        </div>
    </div>

    <div class="container body-content">
        @RenderBody()
        <hr />
    </div>

    <script src="~/Scripts/bootstrap.min.js"></script>
    <script src="~/Scripts/Search.js"></script>
</body>
</html>
<script>
    /*pop over*/
    /*jslint browser: true*/
    /*global $, jQuery*/
    $(document).ready(function () {
        "use strict";
        $("[data-toggle=popover]").popover({
            html: true,
            content: function () {
                return $('#popover-content').html();
            }
        });
        // For v2 [data-toggle="dropdown"] is required for [data-submenu].
        // For v2 .dropdown-submenu > [data-toggle="dropdown"] is forbidden.
        $('[data-submenu]').submenupicker();
    });
</script>